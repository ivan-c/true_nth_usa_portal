{% extends "layout.html" %}
{% block main %}
{% from "flask_user/_macros.html" import render_field, render_checkbox_field, back_btn %}

<div class="portal-well well">

    {{ back_btn('clients','Client Applications') }}

    <h3 class="tnth-headline">Central Services OAuth 2.0 Credentials</h3><br />

    <p><strong>App ID:</strong><br />{{ client.client_id }}</p>

    <p><strong>App Secret:</strong><br />{{ client.client_secret }}</p>

    <p><strong>Service Token:</strong><br />
    {% if service_token %}
        {{ service_token.access_token }}
        {{ service_token.expires_in }}
    {% else %}
        <span class="text-muted">Not yet created</span>
    {% endif %}
    </p>

    <form action="/client/{{ client.client_id }}" method="post">
        {{ form.hidden_tag() }}

        {{ render_field(form.application_role, tabindex=5) }}

        {{ render_field(form.application_origins, tabindex=10,
        helpText="The Application URL may contain one or more origins separated by a single space. Required to include the origin of the client's OAuth authorization redirect_uri and CORS origin values for any in-browser API requests.") }}

        {{ render_field(form.callback_url, tabindex=20,
        helpText="Provide a Callback URL to receive POST requests for signifcant events, such as a user logout from sessions where a valid OAuth token for this application was obtained.  The POST will include a 'signed_request' in the same format as a Facebook signed_request, with at least <b>event</b> and <b>user_id</b> values defined." ) }}

        {% if form.intervention_or_default.name != 'default' %}
            {{ render_field(form.intervention_or_default.card_url, tabindex=30 ) }}

            {{ render_field(form.intervention_or_default.card_html, tabindex=40 ) }}

            {{ render_checkbox_field(form.intervention_or_default.public_access, tabindex=50, helpText="Turn off <b>Public Access</b> to control access to the application on a per user basis.  Only available for interventions assigned an offical application role.  If unchecked, a row for every user needing access must be added via the <b>interventions API</b>.") }}
        {% endif %}

        <br />

        <button type="submit" name="submit" class="btn btn-tnth-primary">Update App Settings</button> &nbsp;&nbsp;&nbsp;&nbsp;
        <button id="confirmDel" type="button" class="btn btn-default" data-placement="top" title="Delete This App">Delete Application</button> &nbsp;
        <button type="submit" name="service_token" value="service_token" class="btn btn-default">
        {% if service_token %}
            Update Service Token
        {% else %}
            Create Service Token
        {% endif %}
        </button>
    </form>

    {% macro render_field(field) %}
    <dt>{{ field.label }}
    <dd>{{ field(**kwargs)|safe }}
        {% if field.errors %}
        <ul class=errors>
            {% for error in field.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    </dd>
    {% endmacro %}

    <br /><br />

</div>

<script>
$(document).ready(function(){
    $('#confirmDel').popover({
        html : true,
        content: "Are you sure you want to delete this app?<br /><br /><button type='submit' name='delete' value='delete' class='btn-tnth-primary btn'>Delete Now</button> &nbsp; <div class='btn btn-default' id='cancelDel'>Cancel</div>"
    })
    $("body").on('click','#cancelDel',function(){
        $('#confirmDel').popover('hide')
    })

});
</script>
{% endblock %}


