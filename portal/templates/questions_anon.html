{% extends "layout.html" %}
{% block main %}

<div class="well">

    <h3 class="tnth-headline">{{ _("TrueNTH") }}</h3>

    <hr />
    <h4>{{ _("Explore on Your Own") }}</h4>
    <p>{{ _("You can access all TrueNTH content, but we won't be able to personalize it for you.") }}</p>
    <br />

    <div class="row">
        <div class="col-xs-6">

            <h4>{{ _("What Are You Looking For?") }}</h4>

        </div>
        <div class="col-xs-6">
            <h4>{{ _("Browse TrueNTH Content") }}</h4>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-6">

            <p><strong>{{ _("Would you like to explore treatment decision-making for early stage prostate cancer?") }}</strong></p>
            <div>
                <div class="btn btn-default pat-q" name="decision" data-value="true">{{ _("Yes") }}</div> &nbsp;&nbsp;&nbsp; <div class="btn btn-default pat-q" name="decision" data-value="false">{{ _("No") }}</div><br />
                <p style="display: none; margin-top: 1em; font-style: italic">{{ _("Great, we suggest viewing") }} <strong>{{ _("Decision Support") }}</strong>.</p>
            </div>
            <br />

        </div>
        <div class="col-xs-6">
            {% set intervention = interventions.decision_support_p3p %}
            <a id="decision" href="{{ intervention.card_url }}"
               class="btn btn-block btn-default btn-lg" style="white-space: normal">
                {{ intervention.card_html }}<br />
                <small>{{ _("Which option is best for me?") }}</small>
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-6">

            <p><strong>{{ _("Have you been treated for prostate cancer and would you like to learn about taking care of side effects and symptoms at home?") }}</strong></p>
            <div>
                <div class="btn btn-default pat-q" name="management" data-value="true">{{ _("Yes") }}</div> &nbsp;&nbsp;&nbsp; <div class="btn btn-default pat-q" name="management" data-value="false">{{ _("No") }}</div><br />
                <p style="display: none; margin-top: 1em;  font-style: italic">{{ _("Great, we suggest viewing") }} <strong>{{ _("Self Management") }}</strong>.</p>
            </div>
            <br />

        </div>
        <div class="col-xs-6">
            {% set intervention = interventions.self_management %}
            <a id="management" href="{{ intervention.card_url }}"
               class="btn btn-block btn-default btn-lg" style="white-space: normal">
                {{ intervention.card_html }}<br />
                <small>{{ _("How do I cope with symptoms?") }}</small>
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-6">

            <p><strong>{{ _("Would you like to view some other web information on prostate cancer?") }}</strong></p>
            <div>
                <div class="btn btn-default pat-q" name="links" data-value="true">{{ _("Yes") }}</div> &nbsp;&nbsp;&nbsp; <div class="btn btn-default pat-q" name="links" data-value="false">{{ _("No") }}</div><br />
                <p style="display: none; margin-top: 1em; font-style: italic">{{ _("Great, we suggest viewing") }} <strong>{{ _("Web Resources") }}</strong>.</p>
            </div>
            <br />

        </div>
        <div class="col-xs-6">
            <a id="links" href='/home'
               class="btn btn-block btn-default btn-lg" style="white-space: normal">
                {{ _("Web Resources") }}<br />
                <small>{{ _("Helpful links about prostate cancer") }}</small>
            </a>
        </div>
    </div>

    <div id="tellUsMore" style="display: none">
        <br /><br />
        <h4>{{ _("Tell Us What Else You'd Like to See") }}</h4>
        <p>{{ _("We're working hard to provide helpful information to men with prostate cancer. What would you like to know about that's not on the TrueNTH website?") }}</p>
        <textarea id="tellUsText" class="form-control" rows="3"></textarea>
        <div style="margin-top: 1em" id="tellUsSave" class="btn btn-default">{{ _("Save") }}</div>
    </div>


</div>

<script>
$(document).ready(function(){

    // Count number of "no" answers so that we can display feedback form if needed
    var noCount = 0;

    $(".pat-q").on("click", function(){
        var thisDiv = $(this);
        // If the link is already active, then don't need to run this
        if (thisDiv.hasClass("active")) {
            return false;
        }
        var toCall = thisDiv.attr("name");
        // Get value from div - either true or false
        var theVal = thisDiv.data("value");
        $.ajax ({
            type: "POST",
            url: '/api/'+toCall+'/{{ user.id }}',
            contentType: "application/json; charset=utf-8",
            dataType: 'json',
            data: JSON.stringify({value: theVal})
        }).always(function(){
            thisDiv.parent().find(".pat-q").removeClass("active");
            thisDiv.addClass("active");
            if (theVal === true) {
                thisDiv.parent().find("p").fadeIn();
                $("#"+toCall).addClass("btn-tnth-primary");
                noCount--;
            } else {
                thisDiv.parent().find("p").hide();
                $("#"+toCall).removeClass("btn-tnth-primary");
                noCount++;
            }
            if (noCount > 2) {
                $("#tellUsMore").fadeIn();
            }
        }).done(function() {

        }).fail(function() {
            //alert("There was a problem updating your profile. Please try again.");
        })
    });
    /** Send the AJAX **/

    $("#tellUsSave").on("click", function(){
        var theFeedback = $("#tellUs").val();
        // TODO - What do we do with this feedback?
        // submit via an API? Generate an email.

        // When we're done with submission, do we give them an opportunity to submit again? Display an email address if they have further thoughts?
    });

});
</script>
{% endblock %}
