{%- extends "profile/profile_base.html" -%}
{%- import "profile/profile_macros.html" as profile_macro -%}
{% block profile_title %}
  {{ _("Patient Profile") }} -
  {%- if user.first_name and user.last_name -%}
    &nbsp;{{user.first_name}} {{user.last_name}}
  {%- elif user.first_name -%}
    &nbsp;{{user.first_name}}
  {%- elif user.last_name -%}
    &nbsp;{{user.last_name}}
  {%- elif user.email -%}
    &nbsp;{{ user.email }}
  {%- else -%}
    &nbsp;#{{ user.id}}
  {%-endif-%}
{% endblock %}
{% block profile_content %}
  {% if config.CUSTOM_PATIENT_DETAIL -%}
    {{ profile_macro.profileCustomDetail(user) }}
    <div class="row">
      <div class="col-md-12 col-xs-12">
        <h4 class="profile-item-title detail-title">{{_("Patient Details")}}</h4>
      </div>
    </div>
  {%- else %}
    <nav id="indexNavBar">
      <span id="loginAsPatient" data-toggle="modal" data-target="#loginAsModal" class="link"><a data-toggle="tooltip" data-placement="top" title="{{_('For kiosk style administration of an assessment')}}">{{ _("Log in as this patient") }}</a></span>
      <div class="modal fade" id="loginAsModal" tabindex="-1" role="dialog" aria-labelledby="loginAsModalLabel">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="loginAsModalLabel">{{ _("Log in as this patient") }}</h4>
              </div>
              <div class="modal-body">
                <br/>
                <p class="text-left">{{ _('This is intended for "kiosk" style administration of an assessment, wherein the staff person "logs in as the patient", which logs the staff person out of their session, and automatically logs in this patient without their needing to enter login credentials. Proceed?') }}</p>
                <br/>
              </div>
              <div class="modal-footer">
                <button id="btnLoginAs" type="button" class="btn btn-default">{{ _("OK") }}</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">{{ _("Cancel") }}</button>
              </div>
            </div>
          </div>
      </div>
    </nav>
  {%- endif %}
  {{profile_macro.profileDemo(user, current_user)}}
  {{profile_macro.profileDemoDetail(user, current_user)}}
  {{profile_macro.profileCommunications(user, current_user)}}
  <div class="row">
    <div class="col-md-12 col-xs-12">
      <div class="profile-item-container {% if (current_user and current_user.has_role(ROLE.STAFF) and ROLE.STAFF in config.CONSENT_EDIT_PERMISSIBLE_ROLES) or (current_user and current_user.has_role(ROLE.ADMIN)) or (user and user.has_role(ROLE.STAFF) and current_user and current_user.has_role(ROLE.STAFF_ADMIN))%}editable{% endif %}" data-sections="org">
        <h4 id="orgsLoc" class="profile-item-title index-item">{{ _("Clinic") }}</h4>
        {{profile_macro.profileOrg(user,None,consent_agreements, current_user)}}
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12 col-xs-12">
      <div class="profile-item-container">
        <h4 id="consentHistoryLoc" class="profile-item-title index-item">{% if config.CONSENT_WITH_TOP_LEVEL_ORG %}{{_("Agreement to Share Clinical Information")}} {%else%}{{ _("Consent History") }} {%endif%}</h4>
        {{profile_macro.profileConsent(user, current_user)}}
      </div>
    </div>
  </div>
  {%- if current_user and current_user.has_role(ROLE.INTERVENTION_STAFF) %}
      {{profile_macro.profileInterventions(user_interventions) | show_macro('interventions')}}
  {%- endif %}
  <div class="row" id="profileSessionListMainContainer">
      <div class="col-md-12 col-xs-12">
        <div class="profile-item-container">
             <h4 id="proAssessmentsLoc" class="profile-item-title index-item">{{ _("PRO Questionnaires") }}</h4>
            {{profile_macro.profileSessionList(user, current_user)}}
        </div>
      </div>
  </div>

  {{profile_macro.profileClinicalQuestions(user, current_user) | show_macro('clinical_questions')}}

  {{profile_macro.profileProcedures(user, current_user) | show_macro('procedures')}}

  {{profile_macro.profileInterventionReports(user) | show_macro('intervention_reports')}}

  <div class="row">
    <div class="col-md-12 col-xs-12">
      <div class="profile-item-container">
        <h4 id="patientReportsLoc" class="profile-item-title index-item">{{ _("Patient Reports") }}</h4>
        {{profile_macro.patientReports(user)}}
      </div>
    </div>
  </div>
  {{profile_macro.profileDeceased(user, current_user)}}
  <div class="row">
    <div class="col-md-12 col-xs-12">
      <div  class="profile-item-container editable" data-sections="locale,timezone">
        <h4 id="timeZoneLocaleLoc" class="profile-item-title index-item">{{_("Locale / Time Zone")}}</h4>
        <div class="view-container">
            <table>
                <tr class="locale-view"><td class="text-muted">{{_("Language")}}</td><td><div id="locale_view"></div></td></tr>
                <tr class="timezone-view"><td class="text-muted">{{_("Time Zone")}}</td><td><div id="timezone_view"></div></td></tr>
            </table>
            <div class="get-demo-error get-locale-error error-message"></div>
            <div class="put-demo-error error-message"></div>
        </div>
        <div class="edit-container flex">
            {{profile_macro.profileLocale(user)|show_macro('language')}}
            {{profile_macro.profileTimeZone(user)}}
        </div>
      </div>
    </div>
  </div>
  {%- if (user and current_user) and current_user.has_role(ROLE.ADMIN) and not user.has_role(ROLE.SERVICE) %}
    <div class="row">
        <div class="col-md-12 col-xs-12">
            <div class="profile-item-container">
                 <h4 id="rolesLoc" class="profile-item-title index-item">{{ _("User Roles") }}</h4>
                 {{profile_macro.profileRole(user, current_user)}}
            </div>
        </div>
    </div>
  {%- endif %}
  {%- if (user and current_user) and (current_user.has_role(ROLE.ADMIN) or current_user.has_role(ROLE.STAFF) or current_user.has_role(ROLE.INTERVENTION_STAFF)) %}
      <div class="row">
          <div class="col-md-12 col-xs-12">
              <div class="profile-item-container">
                  <h4 id="auditLogLoc" class="profile-item-title index-item">{{ _("Audit Log") }}</h4>
                  {{profile_macro.profileAuditLog(user, current_user)}}
              </div>
          </div>
      </div>
  {%- endif %}
{% endblock %}
{% block document_ready %}
  var leafOrgs = {% if current_user.leaf_organizations() %} {{current_user.leaf_organizations() | safe}} {% else %} false{% endif %};
  {{super()}}
{% endblock %}