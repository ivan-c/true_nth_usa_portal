#!/usr/bin/make -f

DH_VIRTUALENV_VERSION = $(shell dh_virtualenv --version | cut -d ' ' -f 2)
DH_VIRTUALENV_ARGS = --preinstall='pip>=8' --preinstall='setuptools>=12'

ifeq ($(shell dpkg --compare-versions "$(DH_VIRTUALENV_VERSION)" "ge" "0.7"; echo $$?),0)
    DH_VIRTUALENV_ARGS += --no-test
endif

distclean:
	rm -Rf build debian/portal/ env

override_dh_virtualenv:
	# Remove this section and requirements.build.txt when dh-virtualenv >= 0.8
	cp requirements.txt requirements.backup.txt
	cat requirements.build.txt requirements.backup.txt > requirements.txt

	dh_virtualenv $(DH_VIRTUALENV_ARGS)

# Remove when dh-virtualenv >= 0.8
override_dh_builddeb:
	dh_builddeb
	if [ -f requirements.backup.txt ]; then mv requirements.backup.txt requirements.txt; fi;

%:
	dh $@ --with python-virtualenv
